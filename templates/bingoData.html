<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Bingo Data</title>

    <!-- Style -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>		
	<link rel="icon" type="image/png" href="{{ url_for('static', filename='5.png') }}"/>
<link rel="icon" type="image/png" href="{{ url_for('static', filename='5.png') }}"/>
<script src="{{ url_for('static', filename='js/goal-list.js') }}" type="text/javascript"></script>
    <style>
	body{
		 padding-right: 30px;
	  padding-left: 30px;
	   padding-top: 5px;
		background:#2c2f33;
		color:#bec7d2;
	}
	#bingo td {
	background:#000811;
	border:2px #0a245a solid;
	color:#3c70df;
	font-size:100%;
	font-weight:400;
	height:100px;
	width:100px;
	max-height:100px;
	max-width:100px;
	text-align:center;

}

#bingo td:hover {
	background:#1448b3;
	color:#fff;
}
	
#bingo tr td.greensquare {
	background:#051;
}

#bingo tr td.greensquare.hover {
	background:#072;
}	

.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-gap: 20px;
}	

.center {
  display: block;
  margin-left: auto;
  margin-right: auto;

}

.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}

input:checked + .slider {
  background-color: #2196F3;
}

input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}

/* Rounded sliders */
.slider.round {
  border-radius: 34px;
}

.slider.round:before {
  border-radius: 50%;
}	
	
	</style>
</head>
<body>
<div style="display:flex;">	
	<div>
	<p> The Fastest Card on the v2020 Patch </p>
				<table id="bingo">
					<tr>
						<td class="popout" id="tlbr">TL-BR</td>
						<td class="popout" id="col1">COL1</td>
						<td class="popout" id="col2">COL2</td>
						<td class="popout" id="col3">COL3</td>
						<td class="popout" id="col4">COL4</td>
						<td class="popout" id="col5">COL5</td>
					</tr>
					<tr>
						<td class="popout" id="row1">ROW1</td>
						<td class="row1 col1 tlbr" id="slot1"></td> 
						<td class="row1 col2" id="slot2"></td> 
						<td class="row1 col3" id="slot3"></td> 
						<td class="row1 col4" id="slot4"></td> 
						<td class="row1 col5 bltr" id="slot5"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row2">ROW2</td>
						<td class="row2 col1" id="slot6"></td> 
						<td class="row2 col2 tlbr" id="slot7"></td> 
						<td class="row2 col3" id="slot8"></td> 
						<td class="row2 col4 bltr" id="slot9"></td> 
						<td class="row2 col5" id="slot10"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row3">ROW3</td>
						<td class="row3 col1" id="slot11"></td> 
						<td class="row3 col2" id="slot12"></td> 
						<td class="row3 col3 tlbr bltr" id="slot13"></td> 
						<td class="row3 col4" id="slot14"></td> 
						<td class="row3 col5" id="slot15"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row4">ROW4</td>
						<td class="row4 col1" id="slot16"></td> 
						<td class="row4 col2 bltr" id="slot17"></td> 
						<td class="row4 col3" id="slot18"></td> 
						<td class="row4 col4 tlbr" id="slot19"></td> 
						<td class="row4 col5" id="slot20"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row5">ROW5</td>
						<td class="row5 col1 bltr" id="slot21"></td> 
						<td class="row5 col2" id="slot22"></td> 
						<td class="row5 col3" id="slot23"></td> 
						<td class="row5 col4" id="slot24"></td> 
						<td class="row5 col5 tlbr" id="slot25"></td> 
					</tr>
					<tr>
						<td class="popout" id="bltr">BL-TR</td>
					</tr>
				</table>

	<p id = "fast"></p>
	</div>
	<div>
		<p> All Cards </p>
		<table id="bingo">
					<tr>
						<td class="popout" id="tlbr">TL-BR</td>
						<td class="popout" id="col1">COL1</td>
						<td class="popout" id="col2">COL2</td>
						<td class="popout" id="col3">COL3</td>
						<td class="popout" id="col4">COL4</td>
						<td class="popout" id="col5">COL5</td>
					</tr>
					<tr>
						<td class="popout" id="row1">ROW1</td>
						<td class="row1 col1 tlbr" id="2slot1"></td> 
						<td class="row1 col2" id="2slot2"></td> 
						<td class="row1 col3" id="2slot3"></td> 
						<td class="row1 col4" id="2slot4"></td> 
						<td class="row1 col5 bltr" id="2slot5"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row2">ROW2</td>
						<td class="row2 col1" id="2slot6"></td> 
						<td class="row2 col2 tlbr" id="2slot7"></td> 
						<td class="row2 col3" id="2slot8"></td> 
						<td class="row2 col4 bltr" id="2slot9"></td> 
						<td class="row2 col5" id="2slot10"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row3">ROW3</td>
						<td class="row3 col1" id="2slot11"></td> 
						<td class="row3 col2" id="2slot12"></td> 
						<td class="row3 col3 tlbr bltr" id="2slot13"></td> 
						<td class="row3 col4" id="2slot14"></td> 
						<td class="row3 col5" id="2slot15"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row4">ROW4</td>
						<td class="row4 col1" id="2slot16"></td> 
						<td class="row4 col2 bltr" id="2slot17"></td> 
						<td class="row4 col3" id="2slot18"></td> 
						<td class="row4 col4 tlbr" id="2slot19"></td> 
						<td class="row4 col5" id="2slot20"></td> 
					</tr>
					<tr> 
						<td class="popout" id="row5">ROW5</td>
						<td class="row5 col1 bltr" id="2slot21"></td> 
						<td class="row5 col2" id="2slot22"></td> 
						<td class="row5 col3" id="2slot23"></td> 
						<td class="row5 col4" id="2slot24"></td> 
						<td class="row5 col5 tlbr" id="2slot25"></td> 
					</tr>
					<tr>
						<td class="popout" id="bltr">BL-TR</td>
					</tr>
				</table>
		<p id = "all"></p>
		<button onclick="nextCard(-1);" type="button" style="color:black;">Prev</button><button onclick="nextCard(1);" type="button" style="color:black;">Next</button>
	</div>
</div>
<br>
<br>
<button onclick="count_all_goals();" type="button" style="color:black;">Count All Goals</button><button onclick="count_chosen_goals();" type="button" style="color:black;">Count Goals Chosen</button>
<p id="goal_data"></p>
<script>
//parse
var bingo = '{{data}}';
bingo = bingo.split('$');
for( var i = 0; i< bingo.length-1;i++){
	bingo[i] = bingo[i].split('@');
	bingo[i][6] = bingo[i][6].split('%');
}

//indexed by id -- changed to an array to it can be sorted
var bingoStats = [];
for (var i = 1; i <= 25; i++){
	for (var j = 0; j < bingoList[i].length; j++){
		var name = bingoList[i][j].name;
		var id = bingoList[i][j].id;
		bingoStats[id] = {"name": name, "tier" : i, "cards_appeared" : [], "cards_picked" : []};
	}
}

//fastest
var fast_time = 999999
var time_index = -1;
for( var i = 0; i< bingo.length-1;i++){
	var time = parseInt(bingo[i][4].replace(":",""));
	if (time< fast_time){
		fast_time = time;
		time_index = i;
	}
}
//Build Card
for( var i = 1; i<= 25 ;i++){
	document.getElementById("slot"+i).innerHTML = bingoStats[parseInt(bingo[time_index][6][i-1])]["name"];
}
//Highlight Row
for( var i = 1; i<= 25 ;i++){
	if (document.getElementById("slot"+i).className.includes(bingo[time_index][3])){
		document.getElementById("slot"+i).style.backgroundColor = "green";
		document.getElementById("slot"+i).style.color = "white";
	}
}
document.getElementById("fast").innerHTML = "Card Info:<br>Player: "+bingo[time_index][5]+"<br>Time: "+bingo[time_index][4]+"<br>Seed: "+bingo[time_index][2]+"<br>Date: "+bingo[time_index][1];


//All Cards
var current_card = 0;
function nextCard(dir){
	current_card = current_card + dir;
	if (current_card > bingo.length-2){
		current_card =0;
	}
	if (current_card < 0){
		current_card = bingo.length-2;
	}
	//Build Card
	for( var i = 1; i<= 25 ;i++){
		document.getElementById("2slot"+i).innerHTML = bingoStats[parseInt(bingo[current_card][6][i-1])]["name"];
		document.getElementById("2slot"+i).style.backgroundColor = "#000811";
		document.getElementById("2slot"+i).style.color = "#3c70df";	
	}
	//Highlight Row
	for( var i = 1; i<= 25 ;i++){
		if (document.getElementById("2slot"+i).className.includes(bingo[current_card][3])){
			document.getElementById("2slot"+i).style.backgroundColor = "green";
			document.getElementById("2slot"+i).style.color = "white";
		}
	}
	document.getElementById("all").innerHTML = "Card Info:<br>Player: "+bingo[current_card][5]+"<br>Time: "+bingo[current_card][4]+"<br>Seed: "+bingo[current_card][2]+"<br>Date: "+bingo[current_card][1];

}

//Mumbo Stuff


//get iindices of goals on card based on row name
function get_indicies_from_row(row_name){
	if (row_name == "bltr"){
		return [4,8,12,16,20];
	}

	if (row_name == "tlbr"){
		return [0,6,12,18,24];
	}

	if (row_name.substr(0,3) == "row"){
		var row_num = parseInt(row_name[3]);
		var offset = 5*row_num-5;
		return [offset, offset+1, offset+2, offset+3, offset+4];
	}

	if (row_name.substr(0,3) == "col"){
		var col_num = parseInt(row_name[3]);
		var offset = col_num;
		return [offset-1, offset+4, offset+9, offset+14, offset+19];
	}

	else{
		console.log("row_name error");
		return -1;
	}

}

function time_hhmmss_to_seconds(time){
	total_time = 0;
	total_time += parseInt(time.substr(0,2))*3600;
	total_time += parseInt(time.substr(3,2))*60;
	total_time += parseInt(time.substr(6,2));
	return total_time;
}

function time_seconds_to_hhmmss(time){
	var hours = Math.floor(time/3600);
	if (hours < 10){
		hours = "0".concat(hours.toString())
	}
	time = time % 3600;
	var minutes = Math.floor(time/60);
	if (minutes < 10){
		minutes = "0".concat(minutes.toString())
	}
	time = time % 60;
	var seconds = Math.floor(time);
	if (seconds < 10){
		seconds = "0".concat(seconds.toString())
	}
	return `${hours}:${minutes}:${seconds}`;

}

//Fills bingoStats with cards each goal appeared on and cards each goal was picked on
function fill_bingoStats_with_cards(){
	for (var i = 0; i < bingo.length-1; i++){
		// console.log(i);
		var card = bingo[i];
		// console.log(card);
		var row_name = card[3];
		var picked_goals = get_indicies_from_row(row_name);

		for (var j = 0; j < 25; j++){
			bingoStats[card[6][j]]["cards_appeared"].push(i);
		}

		for (var k = 0; k < 5; k++){
			var j = picked_goals[k];
			bingoStats[card[6][j]]["cards_picked"].push(i);
		}
	}
}

function generate_basic_stats(){
	var goal_names = Object.keys(bingoStats)
	for (var i = 0; i < goal_names.length; i++){
		
		var goal_name = goal_names[i];
		
		var appeared = bingoStats[goal_name]["cards_appeared"].length
		bingoStats[goal_name]["appeared"] = appeared;
		
		var picked = bingoStats[goal_name]["cards_picked"].length
		bingoStats[goal_name]["picked"] = picked;
		
		var pick_rate = 0;
		if (appeared > 0){
			pick_rate = picked/appeared;
		}
		bingoStats[goal_name]["pick_rate"] = pick_rate

		var total_time = 0;		
		bingoStats[goal_name]["cards_picked"].forEach(calc_row_time);
		function calc_row_time(value, index, array){
			var card = bingo[value];
			var card_time = card[4];
			if (card_time.length == 5){
				card_time = "00:".concat(card_time);
			}
			var xtime = time_hhmmss_to_seconds(card_time);
			total_time += xtime;
		}
		bingoStats[goal_name]["total_time"] = total_time;


		var average_time = 0;
		if (picked > 0){
			average_time = total_time/picked;
		}
		bingoStats[goal_name]["average_time"] = average_time;
		bingoStats[goal_name]["average_time_hhmmss"] = time_seconds_to_hhmmss(average_time);
	}
}

fill_bingoStats_with_cards();
//generate_basic_stats();

// Button to display all goals stats
function count_all_goals(){	
	bingoStats.sort(function(a, b){return b["cards_appeared"].length-a["cards_appeared"].length});
	document.getElementById("goal_data").innerHTML = "";
	for( var i = 0; i< bingoStats.length ;i++){
		document.getElementById("goal_data").innerHTML = document.getElementById("goal_data").innerHTML+ bingoStats[i]["name"]+" :: "+bingoStats[i]["cards_appeared"].length+"<br>";
		}
}

//button to display all picked stats
function count_chosen_goals(){	
	bingoStats.sort(function(a, b){return b["cards_picked"].length-a["cards_picked"].length});
	document.getElementById("goal_data").innerHTML = "";
	for( var i = 0; i< bingoStats.length ;i++){
		document.getElementById("goal_data").innerHTML = document.getElementById("goal_data").innerHTML+ bingoStats[i]["name"]+" :: "+bingoStats[i]["cards_picked"].length+"<br>";
		}
}

</script>
</body>
</html>